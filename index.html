<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kanji Icon Maker</title>

  <!-- Google風フォント -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f9fc;
      --card:#ffffff;
      --accent:#1a73e8;
      --muted:#5f6b76;
      --radius:12px;
      font-family:'Roboto',Arial,sans-serif;
    }
    body{margin:0;background:var(--bg);color:#202124;}
    .container{max-width:900px;margin:30px auto;padding:20px;}
    .header{display:flex;gap:16px;align-items:center;margin-bottom:18px;}
    .logo{width:56px;height:56px;border-radius:12px;
          background:linear-gradient(135deg,var(--accent),#66a6ff);
          display:flex;flex-direction: column;align-items:center;justify-content:center;
          color:white;font-weight:800;font-size:12px;}
    h1{margin:0;font-size:20px;}
    .card{background:var(--card);border-radius:var(--radius);
          padding:18px;box-shadow:0 6px 24px rgba(60,64,67,0.08);}
    input, select, textarea{width:97%;padding:10px;border-radius:8px;
             border:1px solid #e6eef9;font-size:14px;margin-bottom:10px;}
    button.primary{background:var(--accent);color:white;border:none;
                   padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600;}
    .muted{color:var(--muted);font-size:13px;}
    pre{background:#f0f3f7;padding:10px;border-radius:8px;
        overflow-x:auto;max-height:300px;display: none;}
    .svg-preview{border:1px solid #ddd;border-radius:8px;background:#fff;padding:10px;
        margin-top:10px;text-align:center;overflow:auto;
    }
    .svg-preview svg{max-width:100%;height:auto;width:auto;display:block;margin:auto;}
    .error{color:#c62828;font-weight:600;}
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="header">
      <div class="logo"><b style="font-size: 19px;border-bottom: solid 2px #87CEFA;line-height: 1em;">Icon</b><b>Maker</b></div>
      <div>
        <h1>KANJI Icon Maker</h1>
        <div class="muted">文字・背景・画風・サイズなどを指定してSNSで使えるアイコンを生成</div>
      </div>
    </div>

    <div class="card">
      <!-- <div class="muted">画像設定</div> -->

      <label>中心に配置する文字</label>
      <input v-model="kanji" placeholder="例：田中">

      <label>背景スタイル</label>
      <input v-model="background" placeholder="例：青いグラデーション">

      <label>画風</label>
      <input v-model="style" placeholder="例：水彩風、和風、ミニマル">

      <label>画像サイズ</label>
      <select v-model="size">
        <option>256x256</option>
        <option>512x512</option>
        <option>1024x1024</option>
      </select>

      <div style="margin-top:8px;">
        <button class="primary" @click="generate" :disabled="loading">
          <span v-if="!loading">生成</span>
          <span v-else>生成中…</span>
        </button>
      </div>

      <div v-if="error" style="margin-top:8px" class="error">{{ error }}</div>
    </div>

    <div style="height:20px"></div>

    <div class="card" v-if="svgCode">
      <div class="muted">生成された画像</div>
      <pre>{{ svgCode }}</pre>

      <div class="svg-preview" v-html="svgCode"></div>

      <div style="margin-top:10px;">
        <a :href="downloadUrl" download="generated.svg">
          <button class="primary">SVG をダウンロード</button>
        </a>
      </div>
    </div>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          apiKey: "AIzaSyAwC_jwP6kv1N4KQ6oPblQKe7c5coEgVmE",
          kanji: "",
          background: "",
          style: "",
          size: "1024x1024",
          svgCode: "",
          downloadUrl: "",
          loading: false,
          error: null
        }
      },
      methods: {
        async generate() {
          this.error = null;
          this.svgCode = "";
          this.downloadUrl = "";

          if (!this.kanji || this.kanji.trim().length === 0) {
            this.error = "文字を入力してください。";
            return;
          }
          if (!this.background || this.background.trim().length === 0) {
            this.error = "背景スタイルを入力してください。";
            return;
          }

          // プロンプトを構築
          const prompt = `画像サイズ: ${this.size}。背景は${this.background}。画風は${this.style}。中央に大きく「${this.kanji}」という文字を配置してください。`;

          this.loading = true;
          try {
            const modelName = "gemini-2.5-flash-lite";
            // const modelName = "gemini-2.5-flash-image-preview"; //←画像生成もできる？
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent`;

            const body = {
              contents: [
                {
                  role: "user",
                  parts: [
                    {
                      text: `次のリクエストに応じたSVGコードを生成してください。SVGタグを含む完全なコードのみを返してください。説明文や前置きは不要です。\n\nリクエスト: ${prompt}`
                    }
                  ]
                }
              ]
            };

            const resp = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "x-goog-api-key": this.apiKey
              },
              body: JSON.stringify(body)
            });

            if (!resp.ok) {
              const txt = await resp.text();
              throw new Error(`APIエラー: ${resp.status} ${resp.statusText}\n${txt}`);
            }

            const data = await resp.json();
            const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";
            if (!text) throw new Error("SVGコードを取得できませんでした。");

            const match = text.match(/<svg[\s\S]*<\/svg>/i);
            if (!match) {
              throw new Error("レスポンスから <svg> タグを見つけられませんでした。");
            }

            const clean = match[0].trim();
            this.svgCode = clean;

            const blob = new Blob([clean], { type: "image/svg+xml;charset=utf-8" });
            this.downloadUrl = URL.createObjectURL(blob);
          } catch (err) {
            console.error(err);
            this.error = err.message || String(err);
          } finally {
            this.loading = false;
          }
        }
      }
    }).mount("#app");
  </script>
</body>
</html>
