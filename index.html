<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kanji Icon Maker</title>

  <!-- Google風フォント -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f9fc;
      --card:#ffffff;
      --accent:#1a73e8;
      --muted:#5f6b76;
      --radius:12px;
      font-family:'Roboto',Arial,sans-serif;
    }
    body{margin:0;background:var(--bg);color:#202124;}
    .container{max-width:900px;margin:0 auto 10px;padding:20px;}
    .header{display:flex;gap:16px;align-items:center;margin-bottom:18px;}
    .logo{width:56px;height:56px;border-radius:12px;
          background:linear-gradient(135deg,var(--accent),#66a6ff);
          display:flex;flex-direction: column;align-items:center;justify-content:center;
          color:white;font-weight:800;font-size:12px;min-width: 56px;}
    h1{margin:0;font-size:20px;}
    .card{background:var(--card);border-radius:var(--radius);
          padding:18px;box-shadow:0 6px 24px rgba(60,64,67,0.08);}
    input, select, textarea{width:97%;padding:10px;border-radius:8px;
             border:1px solid #c5cbd2;font-size:14px;margin-bottom:0px;}
    select {cursor: pointer;}
    input[type="color"] {
      width: 32px !important;
      height: 32px !important;
      padding:0;
      border: 1px solid #777;
      border-radius: 50%;
      cursor: pointer;
    }
    input[type="color"]::-webkit-color-swatch,
    input[type="color"]::-webkit-color-swatch-wrapper {
      border: none;
      padding: 0;
      border-radius: 50%;
    }
    button.primary{background:var(--accent);color:white;border:none;
                   padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600;word-break: keep-all;}
    .muted{color:var(--muted);font-size:13px;}
    pre{background:#f0f3f7;padding:10px;border-radius:8px;
        overflow-x:auto;max-height:300px;display: none;}
    .svg-preview{border:1px solid #ddd;border-radius:8px;background:#fff;padding:10px;
        margin-top:10px;text-align:center;overflow:auto;}
    .svg-preview svg{max-width:100%;height:auto;width:auto;display:block;margin:auto;}
    .error{color:#c62828;font-weight:600;}
    .flex-row{display:flex;gap:5px;align-items:center;margin-bottom:10px;}
    .flex-row select{width:50%;}
    .flex-row input{width:47%;}
  </style>
</head>
<body>
  <div id="app" class="container">
    <div class="header">
      <div class="logo"><b style="font-size: 19px;border-bottom: solid 2px #87CEFA;line-height: 1em;">Icon</b><b>Maker</b></div>
      <div>
        <h1>KANJI Icon Maker</h1>
        <div class="muted">文字・背景・画風・サイズなどを指定してSNSで使えるアイコンを生成</div>
      </div>
    </div>

    <div class="card">
      <label>文字</label>
      <input style="margin-bottom: 10px; width: calc(100% - 22px);" v-model="kanji" placeholder="例：田中">

      <label>文字のフォント</label>
      <select v-model="font" style="margin-bottom:10px; width:100%;">
        <!-- 日本語向けフォント -->
        <option>Noto Sans JP</option>
        <option>Noto Serif JP</option>
        <option>Yu Gothic</option>
        <option>Meiryo</option>
        <option>Hiragino Kaku Gothic Pro</option>
        <option>Kozuka Gothic Pro</option>
        <option>Futura Std</option>
        <!-- 英語向けフォント -->
        <option>Roboto</option>
        <option>Arial</option>
        <option>Times New Roman</option>
      </select>

      <label>文字色</label>
      <div class="flex-row">
        <select style="margin-right: 8px;" v-model="textColorSelect">
          <option>黒</option>
          <option>白</option>
          <option>赤</option>
          <option>青</option>
          <option>緑</option>
          <option>黄</option>
          <option>ピンク</option>
          <option>オレンジ</option>
        </select>
        <input type="color" v-model="textColor" />
        <div style="margin: 0 0 0 5px;">{{ textColor }}</div>
      </div>

      <label>背景スタイル</label>
      <div class="flex-row">
        <select v-model="backgroundSelect" :disabled="background.trim() !== ''">
          <option>単色</option>
          <option>グラデーション</option>
          <option>ドット</option>
          <option>ボーダー</option>
          <option>ストライプ</option>
          <option>星形</option>
          <option>ハート形</option>
          <option>幾何学模様</option>
          <option>森</option>
          <option>宇宙</option>
          <option>空</option>
        </select>
        <input v-model="background" placeholder="自由入力も可能">
      </div>

      <label>背景色</label>
      <div class="flex-row">
        <select style="margin-right: 8px;" v-model="bgColorSelect">
          <option>白</option>
          <option>黒</option>
          <option>赤</option>
          <option>青</option>
          <option>緑</option>
          <option>黄</option>
          <option>ピンク</option>
          <option>オレンジ</option>
        </select>
        <input type="color" v-model="bgColor" />
        <div style="margin: 0 0 0 5px;">{{ bgColor }}</div>
      </div>

      <!-- <label>画風</label>
      <div class="flex-row">
        <select v-model="styleSelect" :disabled="style.trim() !== ''">
          <option>アイコン風</option>
          <option>漫画風</option>
          <option>手描き風</option>
          <option>水彩風</option>
          <option>和風</option>
          <option>3D風</option>
        </select>
        <input v-model="style" placeholder="自由入力も可能">
      </div> -->

      <label>画像サイズ</label>
      <select v-model="size" style="width: 100%;">
        <option>256x256</option>
        <option>512x512</option>
        <option>1024x1024</option>
      </select>

      <div style="margin-top:10px;">
        <button class="primary" @click="generate" :disabled="loading">
          <span v-if="!loading">生成</span>
          <span v-else>生成中…</span>
        </button>
      </div>

      <div v-if="error" style="margin-top:8px" class="error">{{ error }}</div>
    </div>

    <div style="height:20px"></div>

    <div class="card" v-if="svgCode">
      <div class="muted">生成された画像</div>
      <pre>{{ svgCode }}</pre>

      <div class="svg-preview" v-html="svgCode"></div>

      <div style="margin-top:10px; display:flex; gap:10px;">
        <a :href="downloadUrl" download="generated.svg">
          <button class="primary">SVG をダウンロード</button>
        </a>
        <a :href="pngUrl" download="generated.png">
          <button class="primary">PNG をダウンロード</button>
        </a>
      </div>
    </div>
  </div>

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          apiKey: "AIzaSyAwC_jwP6kv1N4KQ6oPblQKe7c5coEgVmE",
          kanji: "",
          font: "Noto Sans JP",
          textColor: "#000000",
          textColorSelect: "黒",
          background: "",
          backgroundSelect: "単色",
          bgColor: "#ffffff",
          bgColorSelect: "白",
          style: "",
          styleSelect: "アイコン風",
          size: "256x256",
          svgCode: "",
          downloadUrl: "",
          pngUrl: "",
          loading: false,
          error: null,
          colorMap: {
            "白": "#ffffff",
            "黒": "#000000",
            "赤": "#ff0000",
            "青": "#0000ff",
            "緑": "#008000",
            "黄": "#ffff00",
            "ピンク": "#ffc0cb",
            "オレンジ": "#ffa500"
          }
        }
      },
      watch: {
        bgColorSelect(newVal) {
          if (this.colorMap[newVal]) {
            this.bgColor = this.colorMap[newVal];
          }
        },
        bgColor(newVal) {
          const entry = Object.entries(this.colorMap).find(([k,v]) => v.toLowerCase() === newVal.toLowerCase());
          this.bgColorSelect = entry ? entry[0] : "カスタム";
        },
        textColorSelect(newVal) {
          if (this.colorMap[newVal]) {
            this.textColor = this.colorMap[newVal];
          }
        },
        textColor(newVal) {
          const entry = Object.entries(this.colorMap).find(([k,v]) => v.toLowerCase() === newVal.toLowerCase());
          this.textColorSelect = entry ? entry[0] : "カスタム";
        }
      },
      methods: {
        async generate() {
          this.error = null;
          this.svgCode = "";
          this.downloadUrl = "";
          this.pngUrl = "";

          if (!this.kanji || this.kanji.trim().length === 0) {
            this.error = "文字を入力してください。";
            return;
          }

          const bg = this.background.trim() ? this.background : this.backgroundSelect;
          const st = this.style.trim() ? this.style : this.styleSelect;
          const bgColor = this.bgColor;
          const textColor = this.textColor;
          const font = this.font;

          if (!bg) {
            this.error = "背景スタイルを入力または選択してください。";
            return;
          }

          if (!st) {
            this.error = "画風を入力または選択してください。";
            return;
          }

          const prompt = `・画像のサイズ：${this.size}。\n・画像のメイン：画像の中心に「${this.kanji}」という文字をなるべく大きく配置する。文字のフォントは${font}。文字の色は${textColor}。文字は最前面に表示する。\n・画像の背景：背景は「${bg}」を表現する。背景は${bgColor}の色を主に使用する。`;
          // const prompt = `画像サイズ: ${this.size}。背景は${bgColor}の色の${bg}で埋める。画風は${st}。「${this.kanji}」という文字を中心になるべく大きく配置する。文字のフォントは${font}。文字の色は${textColor}。`;

          this.loading = true;
          try {
            const modelName = "gemini-2.5-flash-lite";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent`;

            const body = {
              contents: [
                {
                  role: "user",
                  parts: [
                    {
                      text: `次のリクエストに応じたSVGコードを生成してください。コードは背景が単色の時を除き、50行以上生成すること。動きをつけるコードはNGです。SVGタグを含む完全なコードのみを返してください。説明文や前置きは不要です。\n\nリクエスト\n${prompt}`
                    }
                  ]
                }
              ]
            };

            const resp = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "x-goog-api-key": this.apiKey
              },
              body: JSON.stringify(body)
            });

            if (!resp.ok) {
              const txt = await resp.text();
              throw new Error(`APIエラー: ${resp.status} ${resp.statusText}\n${txt}`);
            }

            const data = await resp.json();
            const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";
            if (!text) throw new Error("SVGコードを取得できませんでした。");

            const match = text.match(/<svg[\s\S]*<\/svg>/i);
            if (!match) {
              throw new Error("レスポンスから <svg> タグを見つけられませんでした。");
            }

            const clean = match[0].trim();
            this.svgCode = clean;

            const blob = new Blob([clean], { type: "image/svg+xml;charset=utf-8" });
            this.downloadUrl = URL.createObjectURL(blob);

            const canvas = document.createElement("canvas");
            const [w, h] = this.size.split("x").map(Number);
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext("2d");

            const img = new Image();
            const svgBlob = new Blob([clean], { type: "image/svg+xml;charset=utf-8" });
            const durl = URL.createObjectURL(svgBlob);

            img.onload = () => {
              ctx.clearRect(0, 0, w, h);
              ctx.drawImage(img, 0, 0, w, h);
              URL.revokeObjectURL(durl);
              this.pngUrl = canvas.toDataURL("image/png");
            };
            img.onerror = (e) => {
              console.error("PNG変換に失敗しました", e);
            };
            img.src = durl;

          } catch (err) {
            console.error(err);
            this.error = err.message || String(err);
          } finally {
            this.loading = false;
          }
        }
      }
    }).mount("#app");
  </script>
</body>
</html>
